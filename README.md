# Argo CD Configuration

[Argo CD](https://argo-cd.readthedocs.io/en/stable/) is a declarative, GitOps continuous delivery tool for Kubernetes. This repository contains the configuration for Argo, as [apps of apps](https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/), so that we can bootstrap the Argo CD installation to manage itself.

## Usage

<https://argo-cd.readthedocs.io/en/stable/understand_the_basics/>

### Bootstrap

The [argo](./argo/) directory contains the installation files for Argo CD.

<https://argo-cd.readthedocs.io/en/stable/getting_started/#1-install-argo-cd>

```sh
# Install ArgoCD
kubectl apply -k argo/overlay

# Instruct ArgoCD to manage itself via GitOps
kubectl apply -f ./config/application.yaml

# Give ArgoCD an application to manage the rest of the applications via AoA
kubectl apply -f ./app-of-apps/application.yaml

# TODO: Add Gateway API setup
kubectl port-forward svc/argocd-server -n argocd 8080:443
```

<https://localhost> will provide the Argo CD UI.

### Configuration

The [config](./config/) directory contains the configuration for Argo CD.

Argo CD applications, projects and settings can be defined declaratively using Kubernetes manifests.

<https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/>

We'll be relying on the secrets generated by Argo to help us install addons. GitOps is tricky, since the cluster secrets are created ad hoc. We'll need to make some changes to the secrets per [the documentation](https://argo-cd.readthedocs.io/en/latest/operator-manual/applicationset/Generators-Cluster/#deploying-to-the-local-cluster).

- Rename the in-cluster cluster to in-cluster-hub (or whatever works for your organization) via the UI.
- Add labels to clusters via the UI. The following labels **MUST** be added **all** clusters:
  - kubernetes.io/environment = sandbox/production

### Applications

The [app-of-apps](./app-of-apps/) directory contains the configuration for the Argo CD AoA that manages the rest of the applications.

Add [addons](./app-of-apps/addons/application-sets) to enable additional functionality for Kubernetes clusters. [clusters](./app-of-apps/clusters/) added will have all addons installed automatically. [environments](./app-of-apps/environments/) can be added to provide common settings across clusters.

Add [apps](./app-of-apps/apps/application-sets) to deploy user space applications to the Kubernetes clusters.
